window.wp=window.wp||{},window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(e.Nouveau={start:function(){this.setupGlobals(),this.prepareDocument(),this.initObjects(),this.setHeartBeat(),this.addListeners()},setupGlobals:function(){this.ajax_request=null,this.objects=t.map(BP_Nouveau.objects,function(e){return e}),this.objectNavParent=BP_Nouveau.object_nav_parent,this.heartbeat=wp.heartbeat||{},this.querystring=this.getLinkParams()},prepareDocument:function(){if(t("body").hasClass("no-js")&&t("body").removeClass("no-js").addClass("js"),BP_Nouveau.warnings&&"undefined"!=typeof console&&console.warn&&t.each(BP_Nouveau.warnings,function(e,t){console.warn(t)}),t(".buddypress_object_nav .widget-title").length){var e=t(".buddypress_object_nav .widget-title").html();t("body").find('*:contains("'+e+'")').each(function(a,s){t(s).hasClass("widget-title")||e!==t(s).html()||t(s).is("a")||t(s).remove()})}},getStorage:function(e,t){var a=sessionStorage.getItem(e);return a=a?JSON.parse(a):{},void 0!==t?a[t]||!1:a},setStorage:function(e,t,a){var s=this.getStorage(e);return void 0===a&&void 0!==s[t]?delete s[t]:s[t]=a,sessionStorage.setItem(e,JSON.stringify(s)),null!==sessionStorage.getItem(e)},getLinkParams:function(e,t){var a;if(!(a=e?-1!==e.indexOf("?")?"?"+e.split("?")[1]:"":document.location.search))return null;var s=a.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return t?s[t]:s},urlDecode:function(e,t){var a=t||{amp:"&",lt:"<",gt:">",quot:'"',"#039":"'"};return decodeURIComponent(e.replace(/\+/g," ")).replace(/&([^;]+);/g,function(e,t){return a[t]||""})},ajax:function(a,s){this.ajax_request&&this.ajax_request.abort();var r=t.extend({},e.Nouveau.getStorage("bp-"+s),{nonce:BP_Nouveau.nonces[s]},a);return void 0!==BP_Nouveau.customizer_settings&&(r.customized=BP_Nouveau.customizer_settings),this.ajax_request=t.post(BP_Nouveau.ajaxurl,r,"json"),this.ajax_request},inject:function(a,s,r){t(a).length&&s&&("append"===(r=r||"reset")?t(a).append(s):"prepend"===r?t(a).prepend(s):t(a).html(s),"undefined"==typeof bp_mentions&&void 0===e.mentions||t(".bp-suggestions").bp_mentions(e.mentions.users))},objectRequest:function(e){var a,s=this;if((e=t.extend({object:"",scope:null,filter:null,target:"#buddypress [data-bp-list]",search_terms:"",page:1,extras:null,caller:null,template:null,method:"reset"},e)).object&&e.target)return e.search_terms&&(e.search_terms=e.search_terms.replace(/</g,"&lt;").replace(/>/g,"&gt;")),null!==e.scope&&this.setStorage("bp-"+e.object,"scope",e.scope),null!==e.filter&&this.setStorage("bp-"+e.object,"filter",e.filter),null!==e.extras&&this.setStorage("bp-"+e.object,"extras",e.extras),t(this.objectNavParent+" [data-bp-object]").each(function(){t(this).removeClass("selected loading")}),t(this.objectNavParent+' [data-bp-scope="'+e.scope+'"], #object-nav li.current').addClass("selected loading"),t('#buddypress [data-bp-filter="'+e.object+'"] option[value="'+e.filter+'"]').prop("selected",!0),"friends"===e.object||"friend_requests"===e.object||"group_members"===e.object?(e.template=e.object,e.object="members"):"group_requests"===e.object?(e.object="groups",e.template="group_requests"):"notifications"===e.object&&(e.object="members",e.template="member_notifications"),a=t.extend({action:e.object+"_filter"},e),this.ajax(a,e.object).done(function(a){if(!1!==a.success){var r=t(s.objectNavParent+' [data-bp-scope="'+e.scope+'"]');if(r.removeClass("loading"),a.data&&a.data.totalItems&&a.data.navLabel&&r.find("a").first().html(a.data.navLabel+"&nbsp;").append(t("<span></span>").addClass("count").html(a.data.totalItems)),"reset"!==e.method)s.inject(e.target,a.data.contents,e.method),t(e.target).trigger("bp_ajax_"+e.method,t.extend(e,{response:a.data}));else if("pag-bottom"===e.caller&&t("#subnav").length){var n=t("#subnav").parent();t("html,body").animate({scrollTop:n.offset().top},"slow",function(){t(e.target).fadeOut(100,function(){s.inject(this,a.data.contents,e.method),t(this).fadeIn(100,"swing",function(){t(e.target).trigger("bp_ajax_request",t.extend(e,{response:a.data}))})})})}else t(e.target).fadeOut(100,function(){s.inject(this,a.data.contents,e.method),t(this).fadeIn(100,"swing",function(){t(e.target).trigger("bp_ajax_request",t.extend(e,{response:a.data}))})})}})},initObjects:function(){var e=this,a={},s={},r="all",n="",i=null,o=null;t.each(this.objects,function(d,p){t('#buddypress [data-bp-list="'+p+'"][data-ajax="false"]').length||(void 0!==(a=e.getStorage("bp-"+p)).scope&&(r=a.scope),void 0!==a.extras&&"notifications"!==p&&(i=a.extras),t('#buddypress [data-bp-filter="'+p+'"]').length&&("-1"!==t('#buddypress [data-bp-filter="'+p+'"]').val()&&"0"!==t('#buddypress [data-bp-filter="'+p+'"]').val()?o=t('#buddypress [data-bp-filter="'+p+'"]').val():void 0!==a.filter&&(o=a.filter,t('#buddypress [data-bp-filter="'+p+'"] option[value="'+o+'"]').prop("selected",!0))),t(this.objectNavParent+' [data-bp-object="'+p+'"]').length&&(t(this.objectNavParent+' [data-bp-object="'+p+'"]').each(function(){t(this).removeClass("selected")}),t(this.objectNavParent+' [data-bp-scope="'+p+'"], #object-nav li.current').addClass("selected")),null!==e.querystring&&(void 0!==e.querystring[p+"_search"]?n=e.querystring[p+"_search"]:void 0!==e.querystring.s&&(n=e.querystring.s),n&&(n=e.urlDecode(n),t('#buddypress [data-bp-search="'+p+'"] input[type=search]').val(n))),t('#buddypress [data-bp-list="'+p+'"]').length&&(s={object:p,scope:r,filter:o,search_terms:n,extras:i},e.objectRequest(s)))})},setHeartBeat:function(){void 0!==BP_Nouveau.pulse&&this.heartbeat&&(this.heartbeat.interval(Number(BP_Nouveau.pulse)),t.fn.extend({"heartbeat-send":function(){return this.bind("heartbeat-send.buddypress")}}),t.fn.extend({"heartbeat-tick":function(){return this.bind("heartbeat-tick.buddypress")}}))},addListeners:function(){t("[data-bp-disable-input]").on("change",this.toggleDisabledInput),t(document).on("heartbeat-send.buddypress",this.heartbeatSend),t(document).on("heartbeat-tick.buddypress",this.heartbeatTick),t(this.objectNavParent+" .bp-navs").on("click","a",this,this.scopeQuery),t("#buddypress [data-bp-filter]").on("change",this,this.filterQuery),t("#buddypress [data-bp-search]").on("submit","form",this,this.searchQuery),t("#buddypress [data-bp-search] form").on("search","input[type=search]",this.resetSearch),t("#buddypress [data-bp-list], #buddypress #item-header").on("click","[data-bp-btn-action]",this,this.buttonAction),t("#buddypress [data-bp-close]").on("click",this,this.closeNotice),t("#buddypress [data-bp-list]").on("click","[data-bp-pagination] a",this,this.paginateAction),BP_Nouveau.bpPasswordVerify&&BP_Nouveau.bpPasswordVerify.requiredPassStrength&&t("#pass1").on("input pwupdate",this.checkPassStrength)},toggleDisabledInput:function(e){var a=t(e.currentTarget),s="#"+a.data("bp-disable-input"),r=a.prop("checked");a.removeClass("enabled disabled"),r?(a.addClass("enabled"),t(s).prop("disabled",!1)):(t(s).prop("disabled",!0),a.addClass("disabled"))},heartbeatSend:function(e,a){t("#buddypress").trigger("bp_heartbeat_send",a)},heartbeatTick:function(e,a){t("#buddypress").trigger("bp_heartbeat_tick",a)},scopeQuery:function(e){var a,s,r,n=e.data,i=t(e.currentTarget).parent(),o="";return i.hasClass("no-ajax")||t(e.currentTarget).hasClass("no-ajax")||!i.attr("data-bp-scope")?e:(a=i.data("bp-scope"),s=i.data("bp-object"),a&&s?(e.preventDefault(),r=t("#buddypress").find('[data-bp-filter="'+s+'"]').first().val(),t('#buddypress [data-bp-search="'+s+'"] input[type=search]').length&&(o=t('#buddypress [data-bp-search="'+s+'"] input[type=search]').val()),i.hasClass("dynamic")&&i.find("a span").html(""),void n.objectRequest({object:s,scope:a,filter:r,search_terms:o,page:1})):e)},filterQuery:function(e){var a=e.data,s=t(e.target).data("bp-filter"),r="all",n=t(e.target).val(),i="";if(!s)return e;t(a.objectNavParent+" [data-bp-object].selected").length&&(r=t(a.objectNavParent+" [data-bp-object].selected").data("bp-scope")),t('#buddypress [data-bp-search="'+s+'"] input[type=search]').length&&(i=t('#buddypress [data-bp-search="'+s+'"] input[type=search]').val()),a.objectRequest({object:s,scope:r,filter:n,search_terms:i,page:1,template:null})},searchQuery:function(e){var a,s,r,n=e.data,i="all";if(t(e.delegateTarget).hasClass("no-ajax")||void 0===t(e.delegateTarget).data("bp-search"))return e;e.preventDefault(),a=t(e.delegateTarget).data("bp-search"),s=t("#buddypress").find('[data-bp-filter="'+a+'"]').first().val(),r=t(e.delegateTarget).find("input[type=search]").first().val(),t(n.objectNavParent+" [data-bp-object]").length&&(i=t(n.objectNavParent+' [data-bp-object="'+a+'"].selected').data("bp-scope")),n.objectRequest({object:a,scope:i,filter:s,search_terms:r,page:1,template:null})},showSearchSubmit:function(e){t(e.delegateTarget).find("[type=submit]").addClass("bp-show"),t("[type=submit]").hasClass("bp-hide")&&t("[type=submit]").removeClass("bp-hide")},resetSearch:function(e){t(e.target).val()?t(e.delegateTarget).find("[type=submit]").show():t(e.delegateTarget).submit()},buttonAction:function(e){var a,s=e.data,r=t(e.currentTarget),n=r.data("bp-btn-action"),i=r.data("bp-nonce"),o=r.closest("[data-bp-item-id]"),d=o.data("bp-item-id"),p=r.closest(".list-wrap"),c=o.data("bp-item-component");if(!n||!d||!c)return e;if(e.preventDefault(),void 0!==BP_Nouveau[n+"_confirm"]&&!1===window.confirm(BP_Nouveau[n+"_confirm"])||r.hasClass("pending"))return!1;i||(i=r.prop("href")),a=s.getLinkParams(i,"_wpnonce");var u={is_friend:"remove_friend",not_friends:"add_friend",pending:"withdraw_friendship",accept_friendship:"accept_friendship",reject_friendship:"reject_friendship"};"members"===c&&void 0!==u[n]&&(n=u[n],c="friends"),r.addClass("pending loading"),s.ajax({action:c+"_"+n,item_id:d,_wpnonce:a},c).done(function(e){if(!1===e.success)p.prepend(e.data.feedback),r.removeClass("pending loading"),o.find(".bp-feedback").fadeOut(6e3);else{if("groups"===c&&void 0!==e.data.is_group&&e.data.is_group)return window.location.reload();if(void 0!==e.data.is_user&&e.data.is_user)return r.parent().html(e.data.feedback),void o.fadeOut(1500);if(t(s.objectNavParent+' [data-bp-scope="personal"]').length){var a=Number(t(s.objectNavParent+' [data-bp-scope="personal"] span').html())||0;-1!==t.inArray(n,["leave_group","remove_friend"])?a-=1:-1!==t.inArray(n,["join_group"])&&(a+=1),a<0&&(a=0),t(s.objectNavParent+' [data-bp-scope="personal"] span').html(a)}r.parent().replaceWith(e.data.contents)}})},closeNotice:function(a){var s=t(a.currentTarget);a.preventDefault(),"clear"===s.data("bp-close")&&(void 0!==t.cookie("bp-message")&&t.removeCookie("bp-message"),void 0!==t.cookie("bp-message-type")&&t.removeCookie("bp-message-type")),s.closest(".bp-feedback").hasClass("bp-sitewide-notice")&&e.Nouveau.ajax({action:"messages_dismiss_sitewide_notice"},"messages"),s.closest(".bp-feedback").remove()},paginateAction:function(e){var a,s,r,n=e.data,i=t(e.currentTarget),o=null,d=null,p=null,c=null;if(null===(a=i.closest("[data-bp-pagination]").data("bp-pagination")||null))return e;e.preventDefault(),null!==(s=t(e.delegateTarget).data("bp-list")||null)&&(void 0!==(r=n.getStorage("bp-"+s)).scope&&(o=r.scope),void 0!==r.filter&&(d=r.filter),void 0!==r.extras&&(c=r.extras)),t('#buddypress [data-bp-search="'+s+'"] input[type=search]').length&&(p=t('#buddypress [data-bp-search="'+s+'"] input[type=search]').val());var u={object:s,scope:o,filter:d,search_terms:p,extras:c,page:n.getLinkParams(i.prop("href"),a)||1};n.objectRequest(u)},checkPassStrength:function(e){var a,s=BP_Nouveau.bpPasswordVerify,r=parseInt(s.requiredPassStrength,10),n=t(e.currentTarget).val(),i=t("#pass2").val(),o=t(e.currentTarget).closest("form");if(a="function"==typeof wp.passwordStrength.userInputDisallowedList?wp.passwordStrength.meter(n,wp.passwordStrength.userInputDisallowedList(),i):wp.passwordStrength.meter(n,wp.passwordStrength.userInputBlacklist(),i),r&&4>=r){var d=t(o).find("#password-warning");a<r?(t(d).length||t(e.currentTarget).before(t("<p></p>").prop("id","password-warning").addClass("description")),t(d).html(s.tooWeakPasswordWarning)):t(d).length&&t(d).remove(),t(o).find("#password-strength-score").length||t(o).prepend(t("<input></input>").prop({id:"password-strength-score",type:"hidden",name:"_password_strength_score"})),t("#password-strength-score").val(a),r>a&&t(".pw-weak").remove()}}},e.Nouveau.start())}(window.bp,jQuery);